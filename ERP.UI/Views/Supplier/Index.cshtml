@model Tuple<IList<SupplierModel>, int>
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>layuiAdmin 内容系统 - 文章列表</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link href="~/LayUI/layuiAdmin/layuiadmin/layui/css/layui.css" rel="stylesheet" />
    <link href="~/LayUI/layuiAdmin/layuiadmin/style/admin.css" rel="stylesheet" />
    <style type="text/css">
        .layui-form-item .layui-input-inline{width:159px;}
    </style>
</head>
<body>

    <div class="layui-fluid">
        <div class="layui-card">
            <div class="layui-card-header layuiadmin-card-header-auto">
                <form class="layui-form" method="get">
                    @{ var suppliermodel = ViewBag.model as SupplierModel;}
                    <div class="layui-form-item">
                        <div class="layui-inline">
                            <label class="layui-form-label">供应商名称</label>
                            <div class="layui-input-inline">
                                <input type="text" name="SupplierName" value="@suppliermodel.SupplierName" placeholder="请输入" autocomplete="off" class="layui-input">
                            </div>
                        </div>
                        <div class="layui-inline">
                            <label class="layui-form-label">联系人</label>
                            <div class="layui-input-inline">
                                <input type="text" name="Contact" value="@suppliermodel.Contact" placeholder="请输入" autocomplete="off" class="layui-input">
                            </div>
                        </div>
                        <div class="layui-inline">
                            <label class="layui-form-label">手机号</label>
                            <div class="layui-input-inline">
                                <input type="text" name="Phone" value="@suppliermodel.Phone" placeholder="请输入" autocomplete="off" class="layui-input">
                            </div>
                        </div>
                        <div class="layui-inline">
                            <label class="layui-form-label">状态</label>
                            <div class="layui-input-inline">
                                <select name="Status">
                                    <option value="">--请选择--</option>
                                    @foreach (var item in (ViewBag.dict as IEnumerable<DictModel>).Where(m => m.DictType == 2))
                                    {
                                        <option value="@item.DictName" @Html.Raw(suppliermodel.Status == item.DictName?"selected=\"selected\"":"")>@item.DictName</option>
                                    }
                                </select>
                            </div>
                        </div>
                        <div class="layui-inline">
                            <button class="layui-btn layuiadmin-btn-list" type="submit">
                                <i class="layui-icon layui-icon-search layuiadmin-button-btn"></i>
                            </button>
                        </div>
                    </div>
                </form>
            </div>

            <form class="layui-form" id="list">
                <div class="layui-card-body">
                    <table class="layui-table">
                        <colgroup>
                            <col width="60">
                            <col>
                            <col>
                            <col>
                            <col>
                            <col>
                            <col>
                            <col>
                        </colgroup>
                        <thead>
                            <tr>
                                <th>选择</th>
                                <th>ID</th>
                                <th>供应商编号</th>
                                <th>供应商名称</th>
                                <th>供应商等级</th>
                                <th>联系人</th>
                                <th>手机号</th>
                                <th>供应商状态</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.Item1)
                            {
                                <tr>
                                    <td align="center"><input type="checkbox" name="SupplierID" value="@item.SupplierID" lay-skin="primary"></td>
                                    <td>@item.SupplierID</td>
                                    <td><a href="@Url.Action("Edit",new { id = item.SupplierID })">@item.SupplierCode</a></td>
                                    <td>@item.SupplierName</td>
                                    <td>@item.SupplierLevel</td>
                                    <td>@item.Contact</td>
                                    <td>@item.Phone</td>
                                    <td>@item.Status</td>
                                    <td>
                                        <a href="javascript:;" id="@item.SupplierID" data-status="@item.Status" class="layui-btn layui-btn-normal layui-btn-sm edit status"><i class="layui-icon layui-icon-edit"></i>@Html.Raw(item.Status == "启用" ? "停用" : "启用")</a>
                                        <a href="javascript:;" id="@item.SupplierID" class="layui-btn layui-btn-danger layui-btn-sm Delete delete"><i class="layui-icon layui-icon-delete"></i> 删除</a>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>

                    <div>
                        <button type="button" class="layui-btn layui-btn-sm selectAll">全选</button>
                        <button lay-submit="" lay-filter="component-form-demo1" class="layui-btn layui-btn-normal layui-btn-sm BatchDelete">批量删除</button>
                        <button lay-submit="" lay-filter="component-form-demo2" class="layui-btn layui-btn-warm layui-btn-sm">批量停用</button>
                        <button lay-submit="" lay-filter="component-form-demo3" class="layui-btn layui-btn-danger layui-btn-sm">批量启用</button>
                    </div>
                    <input type="hidden" name="status" id="status" />
                    <div id="page"></div>
                </div>
            </form>
        </div>
    </div>

    <script src="~/Scripts/jquery-3.4.1.js"></script>
    <script src="~/Scripts/UrlHelper.js"></script>
    <script src="~/LayUI/layuiAdmin/layuiadmin/layui/layui.js"></script>
    <script>
        layui.config({
            base: '/LayUI/layuiAdmin/layuiadmin/' //静态资源所在路径
        }).extend({
            index: 'lib/index' //主入口模块
        }).use(['form', 'index', 'contlist', 'table', 'laypage', 'layer'], function () {
            var form = layui.form;
            var laypage = layui.laypage;
            var layer = layui.layer;

            var count = @Model.Item2;
            var pagesize = 10;

            laypage.render({
                elem: 'page'
                , count: count  //数据总数，从服务端得到
                , curr: getUrlParam("pageindex")
                , limit: pagesize
                , jump: function (obj, first) {
                    //首次不执行
                    if (!first) {
                        setParmsValue("pageindex", obj.curr);
                    }
                }
            });

            //禁用、启用
            $(".status").click(function () {
                var id = $(this).prop("id");
                var status = $(this).data("status");
                var td = $(this).parent().prev();
                var btn = $(this);

                layer.confirm('确认要' + btn.text() + '吗?', { icon: 3, title: '启用/禁用供应商' }, function (index) {
                    $.ajax({
                    url: "@Url.Action("UpdateStatus")",
                    type: "post",
                    dataType: "json",
                    data: { SupplierID: id, status: status},
                    success: function (d) {
                        if (d) {
                            td.text(status == "启用" ? "停用" : "启用");
                            btn.html('<i class="layui-icon layui-icon-edit"></i>' + status);
                        }
                    }
                    })
                    layer.close(index);
                }, function (index) {
                    layer.close(index);
                });
            })

            //删除
            $(".delete").click(function () {
                var id = $(this).prop("id");
                var tr = $(this).parents("tr");

                layer.confirm('确认要删除吗?', { icon: 3, title: '删除供应商' }, function (index) {
                    $.ajax({
                    url: "@Url.Action("Delete")",
                    type: "post",
                    dataType: "json",
                    data: { SupplierID: id},
                    success: function (d) {
                        if (d) {
                            layer.msg("删除成功", {
                                icon: 1,
                                time: 2000 //2秒关闭（如果不配置，默认是3秒）
                            }, function () {
                                tr.remove();
                            });
                        }
                    }
                    })
                    layer.close(index);
                }, function (index) {
                    layer.close(index);
                });
            })

            //全选
            $(".selectAll").click(function () {
                $("[name=SupplierID]").prop("checked", true);
                form.render();
            })

            //批量删除
            form.on('submit(component-form-demo1)', function (data) {

                layer.confirm('确认要批量删除吗?', { icon: 3, title: '删除供应商' }, function (index) {
                    $.ajax({
                        url: "@Url.Action("Delete")",
                        type: "post",
                        dataType: "json",
                        data: $("form#list").serialize(),
                        success: function (d) {
                            layer.msg("删除成功", {
                                icon: 1,
                                time: 2000 //2秒关闭（如果不配置，默认是3秒）
                            }, function () {
                                    window.location.reload();
                            });
                        }
                    })

                    layer.close(index);
                }, function (index) {
                    layer.close(index);
                });


                return false;
            });

            //批量停用
            form.on('submit(component-form-demo2)', function (data) {
                UpdateStatus("停用");
                return false;
            });

            //批量启用
            form.on('submit(component-form-demo3)', function (data) {
                UpdateStatus("启用");
                return false;
            });

            function UpdateStatus(status) {
                layer.confirm('确认要批量' + status + '吗?', { icon: 3, title: status +'供应商' }, function (index) {
                    $("#status").val(status == "启用" ? "停用" : "启用");
                    $.ajax({
                        url: "@Url.Action("UpdateStatus")",
                        type: "post",
                        dataType: "json",
                        data: $("form#list").serialize(),
                        success: function (d) {
                            layer.msg("批量" + status + "成功", {
                                icon: 1,
                                time: 2000 //2秒关闭（如果不配置，默认是3秒）
                            }, function () {
                                    //window.location.reload();
                            });
                        }
                    })

                    layer.close(index);
                }, function (index) {
                    layer.close(index);
                });
            }
        });
    </script>
</body>
</html>
